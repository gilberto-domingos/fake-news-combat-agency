<mat-card class="signup-card">
  <mat-card-header>
    <mat-card-title>Registre-se</mat-card-title>
  </mat-card-header>

  <form class="signup-form" [formGroup]="form" (ngSubmit)="submit()">
    <mat-form-field class="input-full">
      <mat-label>Nome completo</mat-label>
      <input matInput formControlName="full_name" />
      @if (form.get('full_name')?.touched && form.get('full_name')?.hasError('required')) {
        <mat-error> Nome é obrigatório </mat-error>
      }
    </mat-form-field>

    <mat-form-field class="input-full">
      <mat-label>Email</mat-label>
      <input matInput type="email" formControlName="email" [errorStateMatcher]="matcher" />
      <mat-hint>Digite um email válido</mat-hint>

      @if (form.get('email')?.touched && form.get('email')?.hasError('required')) {
        <mat-error> Email é obrigatório </mat-error>
      }
      @if (form.get('email')?.touched && form.get('email')?.hasError('email')) {
        <mat-error> Email inválido </mat-error>
      }
    </mat-form-field>

    <mat-form-field class="input-full">
      <mat-label>Senha</mat-label>
      <input
        matInput
        [type]="hidePassword ? 'password' : 'text'"
        formControlName="password"
        [errorStateMatcher]="matcher"
      />
      <button mat-icon-button matSuffix type="button" (click)="hidePassword = !hidePassword">
        <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
      <mat-hint>Mínimo de 8 caracteres</mat-hint>

      @if (form.get('password')?.touched && form.get('password')?.hasError('required')) {
        <mat-error> Senha é obrigatória </mat-error>
      }
      @if (form.get('password')?.touched && form.get('password')?.hasError('minlength')) {
        <mat-error> A senha deve ter pelo menos 8 caracteres </mat-error>
      }
    </mat-form-field>

    <mat-form-field class="input-full">
      <mat-label>Confirmar senha</mat-label>
      <input
        matInput
        [type]="hideConfirmPassword ? 'password' : 'text'"
        formControlName="confirmPassword"
      />
      <button
        mat-icon-button
        matSuffix
        type="button"
        (click)="hideConfirmPassword = !hideConfirmPassword"
      >
        <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>

      @if (
        form.get('confirmPassword')?.touched && form.get('confirmPassword')?.hasError('required')
      ) {
        <mat-error> Confirmação obrigatória </mat-error>
      }
    </mat-form-field>

    @if (form.touched && form.hasError('mismatch')) {
      <mat-error> As senhas não coincidem </mat-error>
    }

    <mat-checkbox formControlName="terms">
      Aceito os
      <span class="privacy" (click)="goConditions()">Termos</span>
      e a
      <span class="privacy" (click)="goPrivacy()">Política de Privacidade</span>
    </mat-checkbox>
    @if (form.get('terms')?.touched && form.get('terms')?.hasError('required')) {
      <mat-error> Você deve aceitar os termos </mat-error>
    }

    <re-captcha [siteKey]="siteKey" (resolved)="onCaptchaResolved($event)"> </re-captcha>
    @if (form.get('recaptcha')?.touched && form.get('recaptcha')?.invalid) {
      <div class="error">Confirme que você não é um robô</div>
    }

    <mat-card-footer>
      <p>
        Este site é protegido pelo reCAPTCHA e o Google onde se aplicam sua
        <span class="privacy" (click)="googlePrivacy()">Privacidade</span> e
        <span class="privacy" (click)="googleTerms()">Termos de Uso</span>.
      </p>
    </mat-card-footer>

    <mat-card-actions>
      <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">
        Criar conta
      </button>
    </mat-card-actions>
  </form>

  <p class="has-account" (click)="goToLogin()">Já tenho conta</p>
</mat-card>
